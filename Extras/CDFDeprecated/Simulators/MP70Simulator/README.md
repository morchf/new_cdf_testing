# MP70s Device Simulator
## Description
This module manages the creation of objects in CDF and downloading of certificates for these objects/vehicles.  It also publishes data to the configured endpoint using random data or data from simulation files.  Once finished, all changes made by this simulator are removed and cleaned up.

To run the simulator use the *run_simulator.py* script within this directory.  No inputs are required although there are configurations that must be setup prior to running the simulator.

## Configurations
All configurations and changes should be made to the files within this directory
### Required
- In *config.py*, the key **endpoint** must be set to the IoT core endpoint where the simulation vehicles will publish the data.
- In *MP70CertProviderConfig.py*, the follow keys must be set:
    - Key **CDF_ASSETLIB_ENDPOINT** must be set to the CDF Asset Library API Gateway endpoint
    - Key **CDF_CERT_ENDPOINT** must be set to the CDF MP70 Modem Certificates API Gateway endpoint
    - Key **CDF_CSV_BUCKET** must be set to the CDF csv S3 bucket
    - Key **CDF_DELETE_BUCKET** must be set to the CDF delete S3 bucket

### Optional
#### Alternative to AWS CLI
To use manual AWS access keys and secret keys instead of the AWS CLI configuration, set the following configurations
- In *MP70CertProviderConfig.py*:
    - Key **AWS_REGION** must be set to the AWS region where CDF is located
    - Key **AWS_ACCESS_KEY** must be set to your AWS Access Key
    - Key **AWS_SECRET_KEY** must be set to your AWS Secret Key

#### Pre-existing Regions or Agencies
To use pre-existing Regions or Agencies within this simulator, simply modify the following configurations
- In *MP70CertProviderConfig.py*:
    - Modify Key **REGION_NAME** to be the pre-existing region name in CDF that the simulated vehicles should live in
    - Modify Key **AGENCY_NAME** to be the pre-existing agency name in CDF that the simulated vehicles should live in (Requires that the Region also pre-exists)

#### Other
Modify other key/values within the *MP70CertProviderConfig.py* region, agency and vehicle sections as needed for the configuration

## Simulator Inputs
Inputs to the simulator (seen in *run_simulator.py* are detailed here):
- **logging**         :   Boolean
    - General Logging parameter
    - Default is True
- **num_vehicles**    :   Int
    - The number of vehicles of simulate
    - Default is 3
- **default** and **vehicleConfigs**
    - default is a dictionary of the following keys whereas vehicleConfigs is a list of dictionaries containing the following keys
        - file_position     :   The place in the data file for this vehicle to start at (One of: "beginning", "short", "random" or an Integer)
        - gpio              :   The IO for this vehicle to publish with (9 is default)
        - cert_filename, key_filename, and cafile_filename  :   The paths to the certificate files for the vehicles to use (For one device set the files in the first entry of the vehicleConfigs, For multiple devices set these values in the default parameter)
        - speed             :   The speed of the vehicle when using coordinates and generated simulation files (Integer in mph)
        - datetime          :   The datetime of the vehicle when using generated simulation files (the datetime at now is default)
        - priority          :   The priority of the vehicle (High or Low only)
        - class             :   The class of the vehicle (Values 1 - 10 only, 10 is default)
        - coordinates       :   Requires a list of latitude, longitude pairs.  There must be at least two coordinates in the list. Creates a simulation file using these points by creating lines between each pair of points
        - sim_file          :   The path to the simulation file to use for this vehicle/as default

## Commandline interface
This tool can also be accessed in a more limited way through the command line interface, although the commandline interface does not support all of the configurations that are allowed in the full tool.  All of the options listed below can also be configured in the "Config.py" file for easier usage of the commandline interface.

### Options
-d,--devices:       a comma seperated list of devices to simulate when publishing data to the endpoint.  For example: --devices MP706544,MP706545
-c,--cert-file:     the path to the certificate file
-r,--rootca-file:   the path to the rootca file
-k,--key-file:      the path to the private key file
--create-in-cdf:    if the devices simulated should be created in CDF. Default is not to create them
-h,--help:          print this help message and exit

### Arguments
Arguments should be either the path to a file or a list of coordinates optionally followed by an equal sign and a number.  This specifies where the data is coming from (a file or generated by the code) and how many vehicles should run this data (if unspecified, any remaining vehicles will run the data.

Example: 
    GTTAroundOffice.log=10 37.84311,-122.343212,37.853541,-122.338274=15 EastBound.log

### Example
A full example of the use of the command line interface is given below:

python SimulatorMP70.py -d MP706544,MP706545 -c cert.pem -r rootca.pem -k key.key --create-in-cdf GTTAroundOffice.log=10 37.84311,-122.343212,37.853541,-122.338274=15 EastBound.log
